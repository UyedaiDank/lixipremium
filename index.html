<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin - Quản Lý Kho Lì Xì</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --red: #d32f2f; --gold: #ffd700; --bg: #1a1a1a; }
        body { background: #1a1a1a; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .admin-box { background: #2c2c2c; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); max-width: 450px; margin: auto; }
        .group-title { background: var(--red); color: white; padding: 8px; margin-top: 20px; border-radius: 5px; font-weight: bold; font-size: 0.9rem; }
        select, input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; box-sizing: border-box; font-weight: bold; }
        button { background: var(--gold); color: #1a1a1a; cursor: pointer; transition: 0.3s; }
        button:hover { filter: brightness(1.1); }
        .list { margin-top: 15px; text-align: left; background: #000; padding: 10px; border-radius: 8px; font-size: 0.8rem; max-height: 120px; overflow-y: auto; color: #0f0; border: 1px solid #444; }
        #linkShareBox { display: none; margin-top: 20px; background: #333; padding: 15px; border-radius: 10px; border: 1px dashed var(--gold); }
        .random-info { font-size: 0.75rem; color: #aaa; margin-bottom: 5px; font-style: italic; }
    </style>
</head>
<body>
    <h1>⚙️ THIẾT LẬP KHO LÌ XÌ</h1>
    <div class="admin-box">
        
        <div class="group-title">NHÓM 1: DỊCH VỤ MXH (RANDOM SỐ LƯỢNG)</div>
        <select id="smmPlatform">
            <option value="TikTok">TikTok</option>
            <option value="Facebook">Facebook</option>
            <option value="Instagram">Instagram</option>
        </select>
        <select id="smmService">
            <option value="Like">Like (Tim)</option>
            <option value="Follow">Follow</option>
            <option value="View">View (Lượt xem)</option>
        </select>
        
        <p class="random-info">* Số lượng sẽ được Random tự động theo từng bao</p>
        <input type="number" id="smmTotal" placeholder="Số bao lì xì muốn tạo">
        <button onclick="addToPool('SMM')" style="background: #4CAF50; color: white;">THÊM VÀO GIỎ ĐỢI</button>

        <div class="group-title">NHÓM 2: TÀI KHOẢN PREMIUM</div>
        <select id="accPlatform">
            <option value="Netflix">Netflix Premium</option>
            <option value="YouTube">YouTube Premium</option>
            <option value="CapCut">CapCut Premium</option> </select>
        <input type="number" id="accTotal" placeholder="Số bao lì xì muốn tạo">
        <button onclick="addToPool('ACC')">THÊM TÀI KHOẢN</button>

        <div class="list" id="tempList">Chưa có quà nào trong giỏ...</div>
        <button id="createBtn" style="background: #ce1f1f; color: white; margin-top: 20px; font-size: 1.1rem;">XÁC NHẬN TẠO KHO QUÀ</button>

        <div id="linkShareBox">
            <p id="userLinkTxt" style="color: var(--gold); font-size: 0.8rem; word-break: break-all; margin-bottom: 10px;"></p>
            <button onclick="copyLink()" style="background: #2196F3; color: white;">COPY LINK GỬI KHÁCH</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAi-aFwXlI_BtKcbVyV9poRrWkuzfBMCk8",
            authDomain: "quanlilixiacc.firebaseapp.com",
            projectId: "quanlilixiacc",
            storageBucket: "quanlilixiacc.firebasestorage.app",
            messagingSenderId: "351169563993",
            appId: "1:351169563993:web:f7d4df9c18df7f302e9048",
            databaseURL: "https://quanlilixiacc-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentPool = [];

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        window.addToPool = (type) => {
            if(type === 'SMM') {
                const p = document.getElementById('smmPlatform').value;
                const s = document.getElementById('smmService').value;
                const t = parseInt(document.getElementById('smmTotal').value);
                
                if(isNaN(t) || t <= 0) return alert("Nhập số lượng bao!");

                for(let i=0; i<t; i++) {
                    let randomQty = 0;
                    // CẬP NHẬT LOGIC RANDOM MỚI THEO YÊU CẦU
                    if(s === 'Like') randomQty = getRandomInt(200, 400);
                    else if(s === 'Follow') randomQty = getRandomInt(100, 300);
                    else if(s === 'View') randomQty = getRandomInt(100, 1000);

                    currentPool.push({ 
                        category: 'SMM', 
                        platform: p, 
                        service: s, 
                        amount: randomQty, 
                        status: 'available' 
                    });
                }
            } else {
                const p = document.getElementById('accPlatform').value;
                const t = parseInt(document.getElementById('accTotal').value);
                if(isNaN(t) || t <= 0) return alert("Nhập số lượng bao!");
                
                for(let i=0; i<t; i++) {
                    currentPool.push({ category: 'ACC', platform: p, status: 'available' });
                }
            }
            document.getElementById('tempList').innerText = `Đang có ${currentPool.length} bao trong giỏ đợi nạp...`;
        };

        document.getElementById('createBtn').onclick = async () => {
            if(currentPool.length === 0) return alert("Giỏ hàng trống!");
            if(!confirm("Hành động này sẽ xóa kho cũ và tạo kho mới. Đồng ý?")) return;
            
            currentPool.sort(() => Math.random() - 0.5);
            
            try {
                await set(ref(db, 'lixi_services'), currentPool);
                await set(ref(db, 'used_ig'), null);
                alert("Đã tạo kho quà thành công!");
                
                document.getElementById('userLinkTxt').innerText = window.location.href.replace('index.html', 'user.html');
                document.getElementById('linkShareBox').style.display = 'block';
                currentPool = [];
                document.getElementById('tempList').innerText = "Giỏ hàng trống...";
            } catch (e) { alert("Lỗi kết nối Firebase!"); }
        };

        window.copyLink = () => {
            const link = document.getElementById('userLinkTxt').innerText;
            navigator.clipboard.writeText(link).then(() => alert("Đã copy link nhận quà!"));
        };
    </script>
</body>
</html>
