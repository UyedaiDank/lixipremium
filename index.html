<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin - Qu·∫£n L√Ω Kho L√¨ X√¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --red: #d32f2f; --gold: #ffd700; --bg: #1a1a1a; }
        body { background: #1a1a1a; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .admin-box { background: #2c2c2c; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); max-width: 500px; margin: auto; }
        .group-title { background: var(--red); color: white; padding: 8px; margin-top: 20px; border-radius: 5px; font-weight: bold; font-size: 0.9rem; }
        select, input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; box-sizing: border-box; font-weight: bold; }
        button { background: var(--gold); color: #1a1a1a; cursor: pointer; transition: 0.3s; }
        
        /* CSS cho ph·∫ßn hi·ªÉn th·ªã gi·ªè h√†ng */
        .cart-container { margin-top: 20px; text-align: left; background: #000; padding: 15px; border-radius: 10px; border: 1px solid #444; }
        .cart-title { color: var(--gold); font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .cart-list { max-height: 200px; overflow-y: auto; font-size: 0.85rem; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #222; }
        .btn-remove { width: auto; padding: 2px 8px; margin: 0; background: #555; color: #fff; font-size: 0.7rem; }
        .btn-clear { width: auto; padding: 2px 8px; background: #ce1f1f; color: white; border-radius: 4px; font-size: 0.7rem; }
        
        #linkShareBox { display: none; margin-top: 20px; background: #333; padding: 15px; border-radius: 10px; border: 1px dashed var(--gold); }
    </style>
</head>
<body>
    <h1>‚öôÔ∏è QU·∫¢N L√ù KHO L√å X√å</h1>
    <div class="admin-box">
        
        <div class="group-title">1. TH√äM D·ªäCH V·ª§ MXH (RANDOM)</div>
        <select id="smmPlatform">
            <option value="TikTok">TikTok</option>
            <option value="Facebook">Facebook</option>
            <option value="Instagram">Instagram</option>
        </select>
        <select id="smmService">
            <option value="Like">Like (Tim)</option>
            <option value="Follow">Follow</option>
            <option value="View">View</option>
        </select>
        <input type="number" id="smmTotal" placeholder="S·ªë bao mu·ªën t·∫°o">
        <button onclick="addToPool('SMM')" style="background: #4CAF50; color: white;">+ TH√äM V√ÄO GI·ªé</button>

        <div class="group-title">2. TH√äM T√ÄI KHO·∫¢N PREMIUM</div>
        <select id="accPlatform">
            <option value="Netflix">Netflix Premium</option>
            <option value="YouTube">YouTube Premium</option>
            <option value="Spotify">Spotify Premium</option>
        </select>
        <input type="number" id="accTotal" placeholder="S·ªë bao mu·ªën t·∫°o">
        <button onclick="addToPool('ACC')">+ TH√äM V√ÄO GI·ªé</button>

        <div class="cart-container">
            <div class="cart-title">
                üõí GI·ªé H√ÄNG CH·ªú 
                <button class="btn-clear" onclick="clearCart()">X√≥a t·∫•t c·∫£</button>
            </div>
            <div class="cart-list" id="cartItems">
                <p style="color: #666; font-style: italic;">Ch∆∞a c√≥ m√≥n n√†o...</p>
            </div>
        </div>

        <button id="createBtn" style="background: #ce1f1f; color: white; margin-top: 20px; font-size: 1.1rem;">X√ÅC NH·∫¨N T·∫†O KHO QU√Ä</button>

        <div id="linkShareBox">
            <p id="userLinkTxt" style="color: var(--gold); font-size: 0.8rem; word-break: break-all;"></p>
            <button onclick="copyLink()" style="background: #2196F3; color: white;">COPY LINK G·ª¨I KH√ÅCH</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAi-aFwXlI_BtKcbVyV9poRrWkuzfBMCk8",
            authDomain: "quanlilixiacc.firebaseapp.com",
            projectId: "quanlilixiacc",
            storageBucket: "quanlilixiacc.firebasestorage.app",
            messagingSenderId: "351169563993",
            appId: "1:351169563993:web:f7d4df9c18df7f302e9048",
            databaseURL: "https://quanlilixiacc-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let currentPool = [];

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // C·∫≠p nh·∫≠t giao di·ªán gi·ªè h√†ng
        function updateCartUI() {
            const container = document.getElementById('cartItems');
            if (currentPool.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">Ch∆∞a c√≥ m√≥n n√†o...</p>';
                return;
            }

            let html = '';
            // Nh√≥m qu√† l·∫°i ƒë·ªÉ hi·ªÉn th·ªã cho g·ªçn
            let summary = {};
            currentPool.forEach((item, index) => {
                let label = item.category === 'ACC' ? `Acc ${item.platform}` : `${item.service} ${item.platform}`;
                if (!summary[label]) summary[label] = 0;
                summary[label]++;
            });

            for (let label in summary) {
                html += `
                    <div class="cart-item">
                        <span>‚óè ${label}</span>
                        <span>x${summary[label]} bao</span>
                    </div>`;
            }
            container.innerHTML = html;
        }

        window.addToPool = (type) => {
            if(type === 'SMM') {
                const p = document.getElementById('smmPlatform').value;
                const s = document.getElementById('smmService').value;
                const t = parseInt(document.getElementById('smmTotal').value);
                if(isNaN(t) || t <= 0) return alert("Nh·∫≠p s·ªë l∆∞·ª£ng bao!");

                for(let i=0; i<t; i++) {
                    let randomQty = (s === 'Like') ? getRandomInt(100, 789) : (s === 'Follow' ? getRandomInt(100, 456) : getRandomInt(10000, 23456));
                    currentPool.push({ category: 'SMM', platform: p, service: s, amount: randomQty, status: 'available' });
                }
            } else {
                const p = document.getElementById('accPlatform').value;
                const t = parseInt(document.getElementById('accTotal').value);
                if(isNaN(t) || t <= 0) return alert("Nh·∫≠p s·ªë l∆∞·ª£ng bao!");
                for(let i=0; i<t; i++) currentPool.push({ category: 'ACC', platform: p, status: 'available' });
            }
            updateCartUI();
        };

        window.clearCart = () => {
            currentPool = [];
            updateCartUI();
        };

        document.getElementById('createBtn').onclick = async () => {
            if(currentPool.length === 0) return alert("Gi·ªè h√†ng tr·ªëng!");
            currentPool.sort(() => Math.random() - 0.5);
            try {
                await set(ref(db, 'lixi_services'), currentPool);
                await set(ref(db, 'used_ig'), null);
                alert("ƒê√£ t·∫°o kho " + currentPool.length + " bao qu√† th√†nh c√¥ng!");
                document.getElementById('userLinkTxt').innerText = window.location.href.replace('index.html', 'user.html');
                document.getElementById('linkShareBox').style.display = 'block';
                clearCart();
            } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); }
        };

        window.copyLink = () => {
            navigator.clipboard.writeText(document.getElementById('userLinkTxt').innerText);
            alert("ƒê√£ copy link!");
        };
    </script>
</body>
</html>